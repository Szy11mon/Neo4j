<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="http://neo4j-contrib.github.io/developer-resources/language-guides/assets/css/main.css">
    <title>Anime Graph Database</title>
</head>

<body>
<div id="graph">
</div>
<div role="navigation" class="navbar navbar-default navbar-static-top">
        <div class="row">
            <div class="col-sm-6 col-md-6">
                <ul class="nav navbar-nav">
                    <li>
                        <form role="all" class="navbar-form" id="all">
                            <button class="btn btn-default" type="submit">Show All</button>
                        </form>
                        <form role="search" class="navbar-form" id="search">
                            <div class="form-group">
                                <input type="text" value="" placeholder="Search for Anime Title" class="form-control" name="search">
                            </div>
                            <button class="btn btn-default" type="submit">Search</button>
                        </form>
                        <form role="search_studio" class="navbar-form" id="search_studio">
                            <div class="form-group">
                                <input type="text" value="" placeholder="Search by Year" class="form-control" name="search_studio">
                            </div>
                            <button class="btn btn-default" type="submit">Search</button>
                        </form>
                        <form role="search_score" class="navbar-form" id="search_score">
                            <div class="form-group">
                                <input type="text" value="" placeholder="Score Above" class="form-control" name="search_score">
                            </div>
                            <button class="btn btn-default" type="submit">Search</button>
                        </form>
                    </li>
                </ul>
            </div>
            <div class="center-block">
                <div class="navbar-brand">
                    <div>Anime Graph Database</div>
                </div>
            </div>
        </div>
</div>

<div class="row">
    <div class="col-md-5">
        <div class="panel panel-default">
            <div class="panel-heading">Database</div>
            <table id="results" class="table table-striped table-hover">
                <thead>
                <tr>
                    <th>Anime</th>
                    <th>Released</th>
                    <th>Score</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <div class="col-md-7">
        <div class="panel panel-default">
            <div class="panel-heading" id="title">Details</div>
            <div class="row">
                <div class="col-sm-4 col-md-4">
                    <h4>Studio</h4>
                    <div id="studio"></div>
                </div>
                <div class="col-md-8 col-sm-8">
                    <h4>Staff & Cast</h4>
                    <ul id="crew">
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
<style type="text/css">
    .node { stroke: #222; stroke-width: 1.5px; }
    .node.actor { fill: #888; }
    .node.movie { fill: #BBB; }
    .link { stroke: #999; stroke-opacity: .6; stroke-width: 1px; }
</style>

<script type="text/javascript" src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="http://d3js.org/d3.v3.min.js" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        function showMovie(title) {
            $.get("/anime/" + encodeURIComponent(title),
                    function (data) {
                        if (!data) return;
                        $("#title").text(data.title);
                        $("#studio").text(data.studio);
                        var $list = $("#crew").empty();
                        data.cast.forEach(function (cast) {
                            $list.append($("<li>" + cast.name + " " +cast.job + (cast.job == "voiced"?" " + cast.role : "") + "</li>"));
                        });
                    }, "json");
            return false;
        }
        function search() {
            var query=$("#search").find("input[name=search]").val();
            $.get("/search?q=" + encodeURIComponent(query),
                    function (data) {
                        var t = $("table#results tbody").empty();
                        if (!data || data.length == 0) return;
                        data.forEach(function (anime) {
                            $("<tr><td class='anime'>" + anime.title + "</td><td>" + anime.released + "</td><td>" + anime.score + "</td></tr>").appendTo(t)
                                    .click(function() { showMovie($(this).find("td.anime").text());})
                        });
                        showMovie(data[0].title);
                    }, "json");
            return false;
        }

        function search_studio() {
            var query=$("#search_studio").find("input[name=search_studio]").val();
            $.get("/search_studio?q=" + encodeURIComponent(query),
                    function (data) {
                        var t = $("table#results tbody").empty();
                        if (!data || data.length == 0) return;
                        data.forEach(function (anime) {
                            $("<tr><td class='anime'>" + anime.title + "</td><td>" + anime.released + "</td><td>" + anime.score + "</td></tr>").appendTo(t)
                                    .click(function() { showMovie($(this).find("td.anime").text());})
                        });
                        showMovie(data[0].title);
                    }, "json");
            return false;
        }

        function search_score() {
            var query=$("#search_score").find("input[name=search_score]").val();
            $.get("/search_score?q=" + encodeURIComponent(query),
                    function (data) {
                        var t = $("table#results tbody").empty();
                        if (!data || data.length == 0) return;
                        data.forEach(function (anime) {
                            $("<tr><td class='anime'>" + anime.title + "</td><td>" + anime.released + "</td><td>" + anime.score + "</td></tr>").appendTo(t)
                                    .click(function() { showMovie($(this).find("td.anime").text());})
                        });
                        showMovie(data[0].title);
                    }, "json");
            return false;
        }

        function all() {
            var query=$("#search").find("input[name=search]").val();
            $.get("/show",
                    function (data) {
                        var t = $("table#results tbody").empty();
                        if (!data || data.length == 0) return;
                        data.forEach(function (anime) {
                            $("<tr><td class='anime'>" + anime.title + "</td><td>" + anime.released + "</td><td>" + anime.score + "</td></tr>").appendTo(t)
                                    .click(function() { showMovie($(this).find("td.anime").text());})
                        });
                        showMovie(data[0].title);
                    }, "json");
            return false;
        }

        $("#search").submit(search);
        search();
        $("#all").submit(all);
        $("#search_studio").submit(search_studio);
        $("#search_score").submit(search_score);

    })
</script>

</body>
</html>
